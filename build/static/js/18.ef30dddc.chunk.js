(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{313:function(e,t,o){"use strict";o.d(t,"a",function(){return c}),o.d(t,"d",function(){return l}),o.d(t,"c",function(){return u}),o.d(t,"b",function(){return i});var a=o(69),n=o(9),s=o(8),r=o.n(s),c=function(e,t,o,s){return function(c){return r.a.post(n.e,{token:e,coupon:t,restaurant_id:o,subtotal:s}).then(function(e){var t=e.data;return[c({type:a.a,payload:t}),c({type:a.b,payload:null})]}).catch(function(e){if(console.log(e),401===e.response.status)return c({type:a.b,payload:"NOTLOGGEDIN"})})}},l=function(e,t){return function(o){r.a.post(n.Hb,{token:e,restaurant_id:t}).then(function(e){var t=e.data;return o({type:a.c,payload:t})}).catch(function(e){console.log(e)})}},u=function(){return function(e){console.log("Triggred Coupon Removed");return e({type:a.a,payload:{hideMessage:!0,coupon_error:""}})}},i=function(e,t){return function(o){return e.appliedAmount=t,o({type:a.a,payload:e})}}},469:function(e,t,o){"use strict";o.r(t);var a=o(3),n=o(4),s=o(6),r=o(5),c=o(7),l=o(0),u=o.n(l),i=o(49),p=o(115),m=o(11),d=o.n(m),g=o(313),f=o(9),h=o(17),y=o(8),v=o.n(y),b=o(92),S=o.n(b),C=function(e){function t(){var e,o;Object(a.a)(this,t);for(var n=arguments.length,c=new Array(n),l=0;l<n;l++)c[l]=arguments[l];return(o=Object(s.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(c)))).state={inputCoupon:"",loading:!0,couponFailed:!1,couponFailedType:"",couponSubtotalMessage:"",subtotal:null,coupons:[],showSuccess:!1,error_msg:!1},o.__getCartCoupons=function(){var e=o.props.user;e.success&&v.a.post(f.v,{token:e.data.auth_token,subtotal:o.props.location.state,restaurant_id:o.props.restaurant_info.id}).then(function(e){e.data.success&&(o.setState({coupons:e.data.coupons}),o.setState({loading:!1}))}).catch(function(e){console.warn(e.response.data)})},o.handleInput=function(e){o.setState({inputCoupon:e.target.value})},o.handleSubmit=function(e){e.preventDefault();var t=o.props.user.success?o.props.user.data.auth_token:null;o.props.applyCoupon(t,o.state.inputCoupon,o.props.restaurant_info.id,o.props.location.state).then(function(e){e[0].payload.success&&(localStorage.setItem("showSuccessDialog","true"),o.context.router.history.goBack()),e[0].payload.success||(o.setState({error_msg:!0}),setTimeout(function(){o.setState({error_msg:!1})},2e3))})},o.__applyCoupon=function(e){var t=o.props.user.success?o.props.user.data.auth_token:null;o.props.applyCoupon(t,e,o.props.restaurant_info.id,o.props.location.state).then(function(e){e[0].payload.success&&(localStorage.setItem("showSuccessDialog","true"),o.context.router.history.goBack()),e[0].payload.success||(o.setState({error_msg:!0}),setTimeout(function(){o.setState({error_msg:!1})},2e3))})},o}return Object(c.a)(t,e),Object(n.a)(t,[{key:"componentDidMount",value:function(){var e=this;console.log("this.props",this.props),this.setState({subtotal:this.props.location.state}),this.__getCartCoupons(),document.getElementsByTagName("body")[0].classList.add("bg-grey"),localStorage.getItem("appliedCoupon")&&this.setState({inputCoupon:localStorage.getItem("appliedCoupon")},function(){var t=e.props.user.success?e.props.user.data.auth_token:null;e.props.applyCoupon(t,localStorage.getItem("appliedCoupon"),e.props.restaurant_info.id,e.props.subtotal)})}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.coupon;console.log("nextProps-coupon",t),localStorage.removeItem("showSuccessDialog"),t!==e.coupon&&e.coupon.success&&(console.log("SUCCESS COUPON"),localStorage.setItem("appliedCoupon",e.coupon.code),this.setState({couponFailed:!1}))}},{key:"componentWillUnmount",value:function(){document.getElementsByTagName("body")[0].classList.remove("bg-grey")}},{key:"render",value:function(){var e=this,t=this.props,o=(t.coupon,t.user);return u.a.createElement(u.a.Fragment,null,u.a.createElement(i.a,{seotitle:"Coupons",seodescription:localStorage.getItem("seoMetaDescription"),ogtype:"website",ogtitle:localStorage.getItem("seoOgTitle"),ogdescription:localStorage.getItem("seoOgDescription"),ogurl:window.location.href,twittertitle:localStorage.getItem("seoTwitterTitle"),twitterdescription:localStorage.getItem("seoTwitterDescription")}),u.a.createElement(p.a,{boxshadow:!0,has_title:!0,title:"Coupons & Offers",disable_search:!0}),this.state.loading&&u.a.createElement("div",{className:"height-100 overlay-loading ongoing-payment-spin"},u.a.createElement("div",{className:"spin-load"})),this.state.error_msg&&u.a.createElement("div",{className:"auth-error mb-50"},u.a.createElement("div",{className:"error-shake"},"Sorry, this offer is not available")),u.a.createElement("div",{className:"mx-15",style:{position:"relative",paddingTop:"5rem",marginBottom:"-3rem"}},u.a.createElement("form",{className:"coupon-form mb-3 ".concat(!o.success&&"coupon-block-not-loggedin"),onSubmit:this.handleSubmit},u.a.createElement("div",{className:"input-group"},u.a.createElement("input",{type:"text",className:"form-control apply-coupon-input",placeholder:localStorage.getItem("cartCouponText"),onChange:this.handleInput,style:{color:localStorage.getItem("storeColor")},spellCheck:"false",ref:"couponInput"}),u.a.createElement("div",{className:"input-group-append"},u.a.createElement("button",{type:"submit",className:"btn apply-coupon-btn",onClick:this.handleSubmit},u.a.createElement("span",{style:{backgroundColor:localStorage.getItem("cartColorBg"),color:localStorage.getItem("cartColorText")}},localStorage.getItem("applyCouponButtonText")),u.a.createElement(d.a,{duration:"500"}))))),u.a.createElement("hr",null),this.state.coupons.length>0&&u.a.createElement("div",{className:"listedCartCoupons"},this.state.coupons.map(function(t,o){return u.a.createElement(S.a,{key:o,top:!0,delay:100},u.a.createElement("div",{onClick:function(o){o.preventDefault(),e.__applyCoupon(t.code)},key:o,className:"react-reveal position-relative blured-lg",style:{animationFillMode:"both",backfaceVisibility:"visible",animationDuration:"1000ms",animationDelay:"0ms",animationIterationCount:1,opacity:1,animationName:"react-reveal-620367998382870-2"}},u.a.createElement("div",{className:"single-cart-coupon"},u.a.createElement("div",{className:"d-flex justify-content-start mr-2"},u.a.createElement("img",{src:"/assets/img/various/coupon-gift.png",alt:"Coupon",className:"single-cart-coupon-image mr-4"}),u.a.createElement("div",{className:"position-relative",dangerouslySetInnerHTML:{__html:t.display_text}})),t.can_be_applied&&u.a.createElement("div",{className:"single-cart-coupon-applyBtn"},"Apply")),u.a.createElement(d.a,{duration:"500"})))}))))}}]),t}(l.Component);C.contextTypes={router:function(){return null}};t.default=Object(h.b)(function(e){return{coupon:e.coupon.coupon,restaurant_info:e.items.restaurant_info,user:e.user.user}},{applyCoupon:g.a})(C)}}]);
//# sourceMappingURL=18.ef30dddc.chunk.js.map